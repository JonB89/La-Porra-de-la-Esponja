<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Predicciones Champions - 7 Jugadores</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }
        
        .container {
            max-width: 1800px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            color: white;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .player-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .player-btn {
            padding: 10px 20px;
            background-color: #6c757d;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
            font-weight: bold;
        }
        
        .player-btn.active {
            background-color: #2a5298;
            transform: scale(1.05);
        }
        
        .player-btn:hover {
            background-color: #495057;
        }
        
        .content {
            display: grid;
            grid-template-columns: 3fr 1fr;
            gap: 30px;
        }
        
        @media (max-width: 1200px) {
            .content {
                grid-template-columns: 1fr;
            }
        }
        
        .card {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }
        
        .card h2 {
            color: #2a5298;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #eaeaea;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            font-size: 0.9em;
        }
        
        th, td {
            padding: 8px 6px;
            text-align: center;
            border-bottom: 1px solid #eaeaea;
        }
        
        th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: #2a5298;
        }
        
        tr:hover {
            background-color: #f8f9fa;
        }
        
        .match-date {
            background-color: #2a5298;
            color: white;
            font-weight: bold;
            text-align: center;
            padding: 6px;
            margin-top: 15px;
            border-radius: 5px;
        }
        
        .team-name {
            text-align: left;
            font-weight: 500;
            min-width: 180px;
        }
        
        .odds {
            font-weight: 600;
        }
        
        .low-odds {
            color: #e74c3c;
            font-weight: bold;
        }
        
        .penalty {
            background-color: #fff3cd;
            color: #856404;
            font-weight: bold;
            border-radius: 4px;
            padding: 2px 4px;
            font-size: 0.8em;
        }
        
        .instructions {
            background-color: #e8f4fd;
            border-left: 4px solid #2a5298;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 0 5px 5px 0;
        }
        
        .instructions h3 {
            margin-bottom: 10px;
            color: #2a5298;
        }
        
        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: #6c757d;
            font-size: 0.9rem;
        }
        
        .highlight {
            background-color: #fff3cd;
            padding: 2px 5px;
            border-radius: 3px;
        }
        
        input {
            width: 40px;
            padding: 4px;
            text-align: center;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 0.9em;
        }
        
        .result-cell {
            min-width: 60px;
        }
        
        .acierto-exacto {
            background-color: #d4edda;
            color: #155724;
            font-weight: bold;
        }
        
        .acierto-1x2 {
            background-color: #fff3cd;
            color: #856404;
            font-weight: bold;
        }
        
        .fallo {
            background-color: #f8d7da;
            color: #721c24;
            font-weight: bold;
        }
        
        .puntos {
            font-weight: bold;
            font-size: 1em;
        }
        
        .controls {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        button {
            background-color: #2a5298;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background-color 0.3s;
            flex: 1;
            min-width: 120px;
        }
        
        button:hover {
            background-color: #1e3c72;
        }
        
        .total-points {
            text-align: center;
            margin-top: 20px;
            padding: 15px;
            background-color: #e8f4fd;
            border-radius: 5px;
            font-size: 1.1rem;
            font-weight: bold;
        }
        
        .data-section {
            margin-top: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 5px;
        }
        
        textarea {
            width: 100%;
            height: 100px;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: monospace;
            resize: vertical;
            font-size: 0.9em;
        }
        
        .import-export-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .export-btn {
            background-color: #28a745;
        }
        
        .export-btn:hover {
            background-color: #218838;
        }
        
        .import-btn {
            background-color: #17a2b8;
        }
        
        .import-btn:hover {
            background-color: #138496;
        }
        
        .ranking-table {
            width: 100%;
            margin-top: 20px;
        }
        
        .ranking-table th {
            background-color: #2a5298;
            color: white;
        }
        
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .summary-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            text-align: center;
            border-left: 4px solid #2a5298;
        }
        
        .summary-card h4 {
            margin: 0 0 10px 0;
            color: #2a5298;
            font-size: 1.1em;
        }
        
        .summary-points {
            font-size: 1.5em;
            font-weight: bold;
            color: #1e3c72;
        }
        
        .real-results-section {
            background-color: #fff3cd;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #ffc107;
        }
        
        .real-results-section h3 {
            margin-top: 0;
            color: #856404;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Predicciones Champions League</h1>
            <p class="subtitle">Jornada 2 - Sistema para 7 Jugadores</p>
        </header>
        
        <div class="instructions">
            <h3>Instrucciones</h3>
            <p>1. <strong>Selecciona un jugador</strong> para ver/editar sus predicciones</p>
            <p>2. Introduce predicciones en formato "golesLocal-golesVisitante" (ej: 2-1)</p>
            <p>3. <strong>Una vez se conozcan los resultados</strong>, introd√∫celos en la secci√≥n "Resultados Reales" (s√≥lo una vez para todos)</p>
            <p>4. Los puntos se calculan autom√°ticamente para todos los jugadores</p>
            <p>5. <span class="highlight">Acierto Exacto</span>: 12 puntos | <span class="highlight">Acierto 1X2</span>: 8 puntos | <span class="highlight">Fallo</span>: Penalizaci√≥n o 0 puntos</p>
        </div>

        <!-- Selector de Jugadores -->
        <div class="player-selector" id="player-selector">
            <!-- Los botones de jugadores se generar√°n aqu√≠ -->
        </div>

        <!-- Resumen de Puntos -->
        <div class="card">
            <h2>Resumen de Puntos - Todos los Jugadores</h2>
            <div class="summary-grid" id="summary-grid">
                <!-- El resumen se generar√° aqu√≠ -->
            </div>
        </div>
        
        <div class="content">
            <div class="card">
                <h2 id="current-player-title">Predicciones de <span id="current-player">Adri√°n</span></h2>
                
                <!-- Secci√≥n para resultados reales -->
                <div class="real-results-section">
                    <h3>üìù Resultados Reales (Compartidos para todos)</h3>
                    <p><small>Introduce aqu√≠ los resultados una sola vez. Se aplicar√°n autom√°ticamente a todos los jugadores.</small></p>
                    <table>
                        <thead>
                            <tr>
                                <th>Hora</th>
                                <th>Partido</th>
                                <th>Resultado Real</th>
                            </tr>
                        </thead>
                        <tbody id="real-results-table">
                            <!-- Los inputs para resultados reales se generar√°n aqu√≠ -->
                        </tbody>
                    </table>
                </div>
                
                <div class="match-date">30 Septiembre 2025 - Fase de Liga</div>
                <table id="matches-table">
                    <thead>
                        <tr>
                            <th>Hora</th>
                            <th>Partido</th>
                            <th>Cuotas</th>
                            <th>Mi Predicci√≥n</th>
                            <th>Acierto</th>
                            <th>Puntos</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Los partidos se cargar√°n aqu√≠ mediante JavaScript -->
                    </tbody>
                </table>
                
                <div class="controls">
                    <button id="calculate-btn">Recalcular Todos</button>
                    <button id="clear-btn">Limpiar Jugador Actual</button>
                    <button id="export-btn" class="export-btn">Exportar Todos</button>
                </div>
                
                <div class="total-points" id="total-points">
                    Puntuaci√≥n de <span id="player-points-name">Adri√°n</span>: <span id="points-value">0</span> puntos
                </div>

                <!-- Ranking de Jugadores -->
                <h3 style="margin-top: 30px;">Clasificaci√≥n Detallada</h3>
                <table class="ranking-table">
                    <thead>
                        <tr>
                            <th>Pos</th>
                            <th>Jugador</th>
                            <th>Puntos</th>
                            <th>Aciertos Exactos</th>
                            <th>Aciertos 1X2</th>
                            <th>Fallos</th>
                        </tr>
                    </thead>
                    <tbody id="ranking-body">
                        <!-- El ranking se generar√° aqu√≠ -->
                    </tbody>
                </table>
                
                <div class="data-section">
                    <h3>Gesti√≥n de Datos</h3>
                    <p>Para guardar/recuperar todas las predicciones:</p>
                    <textarea id="data-textarea" placeholder="Los datos exportados aparecer√°n aqu√≠..."></textarea>
                    
                    <div class="import-export-buttons">
                        <button id="import-btn" class="import-btn">Importar Todos</button>
                        <button id="copy-data-btn">Copiar Texto</button>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <h2>Tabla de Penalizaciones</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Cotizaci√≥n</th>
                            <th>Penalizaci√≥n</th>
                            <th>Cotizaci√≥n</th>
                            <th>Penalizaci√≥n</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td>Hasta 1.10</td><td class="penalty">-82</td><td>1.40-1.41</td><td class="penalty">-16</td></tr>
                        <tr><td>1.11</td><td class="penalty">-74</td><td>1.42-1.43</td><td class="penalty">-15</td></tr>
                        <tr><td>1.12</td><td class="penalty">-68</td><td>1.44-1.45</td><td class="penalty">-14</td></tr>
                        <tr><td>1.13</td><td class="penalty">-62</td><td>1.46-1.48</td><td class="penalty">-13</td></tr>
                        <tr><td>1.14</td><td class="penalty">-57</td><td>1.49-1.51</td><td class="penalty">-12</td></tr>
                        <tr><td>1.15</td><td class="penalty">-53</td><td>1.52-1.54</td><td class="penalty">-11</td></tr>
                        <tr><td>1.16</td><td class="penalty">-49</td><td>1.55-1.57</td><td class="penalty">-10</td></tr>
                        <tr><td>1.17</td><td class="penalty">-46</td><td>1.58-1.60</td><td class="penalty">-9</td></tr>
                        <tr><td>1.18</td><td class="penalty">-43</td><td>1.61</td><td class="penalty">-9</td></tr>
                        <tr><td>1.19</td><td class="penalty">-41</td><td>1.62-1.64</td><td class="penalty">-8</td></tr>
                        <tr><td>1.20</td><td class="penalty">-38</td><td>1.65-1.66</td><td class="penalty">-8</td></tr>
                        <tr><td>1.21</td><td class="penalty">-36</td><td>1.67-1.69</td><td class="penalty">-7</td></tr>
                        <tr><td>1.22</td><td class="penalty">-34</td><td>1.70-1.72</td><td class="penalty">-7</td></tr>
                        <tr><td>1.23</td><td class="penalty">-33</td><td>1.73-1.75</td><td class="penalty">-6</td></tr>
                        <tr><td>1.24</td><td class="penalty">-31</td><td>1.76-1.78</td><td class="penalty">-6</td></tr>
                        <tr><td>1.25</td><td class="penalty">-29</td><td>1.79-1.81</td><td class="penalty">-5</td></tr>
                        <tr><td>1.26</td><td class="penalty">-28</td><td>1.82-1.86</td><td class="penalty">-5</td></tr>
                        <tr><td>1.27</td><td class="penalty">-27</td><td>1.87-1.90</td><td class="penalty">-4</td></tr>
                        <tr><td>1.28</td><td class="penalty">-26</td><td>1.91-1.95</td><td class="penalty">-4</td></tr>
                        <tr><td>1.29</td><td class="penalty">-25</td><td>1.96-1.99</td><td class="penalty">-3</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <footer>
            <p>Sistema de Predicciones Champions League &copy; 2025 - 7 Jugadores</p>
        </footer>
    </div>

    <script>
        // Configuraci√≥n
        const playerNames = ["Adri√°n", "Julen", "Joseba", "Imanol", "Markel", "Barry", "Endika"];
        const TOTAL_PLAYERS = playerNames.length;
        let currentPlayer = 1;

        // Datos de los partidos
        const matches = [
            // 30 de septiembre
            { date: "30 Sep 2025", time: "18:45", home: "Atalanta", away: "Club Brugge KV", odds1: 1.88, oddsX: 3.85, odds2: 3.79 },
            { date: "30 Sep 2025", time: "18:45", home: "Kairat Almaty", away: "Real Madrid", odds1: 23.90, oddsX: 9.78, odds2: 1.10 },
            { date: "30 Sep 2025", time: "21:00", home: "Atl. Madrid", away: "Eintracht Frankfurt", odds1: 1.61, oddsX: 4.25, odds2: 5.10 },
            { date: "30 Sep 2025", time: "21:00", home: "Bodo/Gilmt", away: "Tottenham", odds1: 3.09, oddsX: 3.81, odds2: 2.14 },
            { date: "30 Sep 2025", time: "21:00", home: "Chelsea", away: "Benfica", odds1: 1.58, oddsX: 4.21, odds2: 5.41 },
            { date: "30 Sep 2025", time: "21:00", home: "Galatasaray", away: "Liverpool", odds1: 4.55, oddsX: 4.50, odds2: 1.63 },
            { date: "30 Sep 2025", time: "21:00", home: "Inter", away: "Slavia Prague", odds1: 1.35, oddsX: 5.32, odds2: 8.03 },
            { date: "30 Sep 2025", time: "21:00", home: "Marseille", away: "Ajax", odds1: 1.53, oddsX: 4.49, odds2: 5.63 },
            { date: "30 Sep 2025", time: "21:00", home: "Pafos", away: "Bayern Munich", odds1: 19.75, oddsX: 8.53, odds2: 1.13 },
            
            // 1 de octubre
            { date: "01 Oct 2025", time: "18:45", home: "Qarabag", away: "FC Copenhagen", odds1: 1.00, oddsX: 2.00, odds2: 2.00 },
            { date: "01 Oct 2025", time: "18:45", home: "Royale Union SG", away: "Newcastle", odds1: 2.73, oddsX: 3.45, odds2: 2.51 },
            { date: "01 Oct 2025", time: "21:00", home: "Arsenal", away: "Olympiacos Piraeus", odds1: 3.20, oddsX: 3.61, odds2: 2.15 },
            { date: "01 Oct 2025", time: "21:00", home: "Barcelona", away: "PSG", odds1: 1.22, oddsX: 6.29, odds2: 13.44 },
            { date: "01 Oct 2025", time: "21:00", home: "Bayer Leverkusen", away: "PSV", odds1: 1.94, oddsX: 4.04, odds2: 3.42 },
            { date: "01 Oct 2025", time: "21:00", home: "Dortmund", away: "Ath Bilbao", odds1: 1.85, oddsX: 4.01, odds2: 3.80 },
            { date: "01 Oct 2025", time: "21:00", home: "Monaco", away: "Manchester City", odds1: 1.83, oddsX: 3.73, odds2: 4.19 },
            { date: "01 Oct 2025", time: "21:00", home: "Napoli", away: "Sporting CP", odds1: 5.91, oddsX: 4.65, odds2: 1.49 },
            { date: "01 Oct 2025", time: "21:00", home: "Villarreal", away: "Juventus", odds1: 1.82, oddsX: 3.71, odds2: 4.25 }
        ];

        // Tabla de penalizaciones
        const penaltyTable = {
            "1.10": -82, "1.11": -74, "1.12": -68, "1.13": -62, "1.14": -57, "1.15": -53,
            "1.16": -49, "1.17": -46, "1.18": -43, "1.19": -41, "1.20": -38, "1.21": -36,
            "1.22": -34, "1.23": -33, "1.24": -31, "1.25": -29, "1.26": -28, "1.27": -27,
            "1.28": -26, "1.29": -25, "1.30": -24, "1.31": -23, "1.32": -22, "1.33": -21,
            "1.34": -20, "1.35": -19, "1.36": -19, "1.37": -18, "1.38": -17, "1.39": -17,
            "1.40": -16, "1.41": -16, "1.42": -15, "1.43": -15, "1.44": -14, "1.45": -14,
            "1.46": -13, "1.47": -13, "1.48": -13, "1.49": -12, "1.50": -12, "1.51": -12,
            "1.52": -11, "1.53": -11, "1.54": -11, "1.55": -10, "1.56": -10, "1.57": -10,
            "1.58": -9, "1.59": -9, "1.60": -9, "1.61": -9, "1.62": -8, "1.63": -8,
            "1.64": -8, "1.65": -8, "1.66": -8, "1.67": -7, "1.68": -7, "1.69": -7,
            "1.70": -7, "1.71": -7, "1.72": -7, "1.73": -6, "1.74": -6, "1.75": -6,
            "1.76": -6, "1.77": -6, "1.78": -6, "1.79": -5, "1.80": -5, "1.81": -5,
            "1.82": -5, "1.83": -5, "1.84": -5, "1.85": -5, "1.86": -5, "1.87": -4,
            "1.88": -4, "1.89": -4, "1.90": -4, "1.91": -4, "1.92": -4, "1.93": -4,
            "1.94": -4, "1.95": -4, "1.96": -3, "1.97": -3, "1.98": -3, "1.99": -3
        };

        // Almacenamiento de datos
        let realResults = Array(matches.length).fill("");
        let allPlayersData = Array.from({length: TOTAL_PLAYERS}, () => 
            Array.from({length: matches.length}, () => ({ pred: "" }))
        );

        // Funci√≥n para obtener la penalizaci√≥n
        function getPenalty(odd) {
            if (odd >= 2.0) return 0;
            const oddKey = Object.keys(penaltyTable).find(key => odd <= parseFloat(key));
            return penaltyTable[oddKey] || 0;
        }

        function getResult(goalsHome, goalsAway) {
            if (goalsHome > goalsAway) return '1';
            if (goalsHome < goalsAway) return '2';
            return 'X';
        }

        function parseScore(scoreStr) {
            if (!scoreStr) return null;
            const parts = scoreStr.split('-');
            if (parts.length !== 2) return null;
            const home = parseInt(parts[0].trim());
            const away = parseInt(parts[1].trim());
            if (isNaN(home) || isNaN(away)) return null;
            return { home, away };
        }

        function calculateMatchPoints(predictionStr, resultStr, odds1, oddsX, odds2) {
            const prediction = parseScore(predictionStr);
            const result = parseScore(resultStr);
            
            if (!prediction || !result) return { type: "", points: 0, exact: 0, sign: 0, fail: 1 };
            
            // Acierto exacto
            if (prediction.home === result.home && prediction.away === result.away) {
                return { type: "Acierto Exacto", points: 12, exact: 1, sign: 0, fail: 0 };
            }
            
            // Acierto 1X2
            const predResult = getResult(prediction.home, prediction.away);
            const actualResult = getResult(result.home, result.away);
            
            if (predResult === actualResult) {
                return { type: "Acierto 1X2", points: 8, exact: 0, sign: 1, fail: 0 };
            }
            
            // Fallo con penalizaci√≥n
            let selectedOdd;
            if (predResult === '1') selectedOdd = odds1;
            else if (predResult === 'X') selectedOdd = oddsX;
            else selectedOdd = odds2;
            
            const penalty = getPenalty(selectedOdd);
            return { type: "Fallo", points: penalty, exact: 0, sign: 0, fail: 1 };
        }

        // Funci√≥n para cargar la interfaz
        function loadMatches() {
            loadRealResultsTable();
            loadPlayerPredictionsTable();
            createPlayerSelectors();
            calculateAllPoints();
        }

        // Funci√≥n para cargar la tabla de resultados reales
        function loadRealResultsTable() {
            const tbody = document.getElementById("real-results-table");
            tbody.innerHTML = "";
            
            let currentDate = "";
            
            matches.forEach((match, index) => {
                if (match.date !== currentDate) {
                    currentDate = match.date;
                    const dateRow = document.createElement("tr");
                    dateRow.innerHTML = `<td colspan="3" style="background-color: #2a5298; color: white; font-weight: bold;">${match.date}</td>`;
                    tbody.appendChild(dateRow);
                }
                
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${match.time}</td>
                    <td class="team-name">${match.home} vs ${match.away}</td>
                    <td>
                        <input type="text" id="real-input-${index}" placeholder="0-0" maxlength="5" 
                               value="${realResults[index]}" data-match="${index}">
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Funci√≥n para cargar la tabla de predicciones del jugador
        function loadPlayerPredictionsTable() {
            const tbody = document.querySelector("#matches-table tbody");
            tbody.innerHTML = "";
            
            let currentDate = "";
            
            matches.forEach((match, index) => {
                if (match.date !== currentDate) {
                    currentDate = match.date;
                    const dateRow = document.createElement("tr");
                    dateRow.innerHTML = `<td colspan="6" class="match-date">${match.date} - Fase de Liga</td>`;
                    tbody.appendChild(dateRow);
                }
                
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${match.time}</td>
                    <td class="team-name">${match.home} vs ${match.away}</td>
                    <td>
                        <span class="${match.odds1 < 2 ? 'low-odds' : ''}">${match.odds1}</span> / 
                        <span>${match.oddsX}</span> / 
                        <span class="${match.odds2 < 2 ? 'low-odds' : ''}">${match.odds2}</span>
                    </td>
                    <td class="result-cell">
                        <input type="text" id="pred-${index}" placeholder="0-0" maxlength="5" 
                               value="${allPlayersData[currentPlayer-1][index].pred}" data-match="${index}">
                    </td>
                    <td id="type-${index}" class="result-type"></td>
                    <td id="points-${index}" class="puntos"></td>
                `;
                tbody.appendChild(row);
            });
        }

        // Funci√≥n para crear selectores de jugadores
        function createPlayerSelectors() {
            const selector = document.getElementById("player-selector");
            selector.innerHTML = "";
            
            playerNames.forEach((name, index) => {
                const button = document.createElement("button");
                button.className = `player-btn ${index === currentPlayer-1 ? 'active' : ''}`;
                button.textContent = name;
                button.onclick = () => switchPlayer(index + 1);
                selector.appendChild(button);
            });
        }

        // Funci√≥n para cambiar de jugador
        function switchPlayer(playerNumber) {
            saveCurrentPlayerData();
            currentPlayer = playerNumber;
            loadPlayerPredictionsTable();
            updatePlayerInterface();
            calculateCurrentPlayerPoints();
        }

        // Funci√≥n para actualizar interfaz
        function updatePlayerInterface() {
            document.getElementById("current-player").textContent = playerNames[currentPlayer-1];
            document.getElementById("player-points-name").textContent = playerNames[currentPlayer-1];
            
            document.querySelectorAll('.player-btn').forEach((btn, index) => {
                btn.classList.toggle('active', index === currentPlayer-1);
            });
        }

        // Funci√≥n para guardar datos del jugador actual
        function saveCurrentPlayerData() {
            matches.forEach((match, index) => {
                const predictionInput = document.getElementById(`pred-${index}`);
                if (predictionInput) {
                    allPlayersData[currentPlayer-1][index].pred = predictionInput.value;
                }
            });
            saveLocalData();
        }

        // Funci√≥n para guardar resultados reales
        function saveRealResults() {
            matches.forEach((match, index) => {
                const realInput = document.getElementById(`real-input-${index}`);
                if (realInput && realInput.value) {
                    realResults[index] = realInput.value;
                }
            });
            saveLocalData();
        }

        // Funci√≥n para calcular puntos del jugador actual
        function calculateCurrentPlayerPoints() {
            let totalPoints = 0;
            
            matches.forEach((match, index) => {
                const predictionInput = document.getElementById(`pred-${index}`);
                const typeCell = document.getElementById(`type-${index}`);
                const pointsCell = document.getElementById(`points-${index}`);
                
                const prediction = predictionInput ? predictionInput.value : "";
                const result = realResults[index];
                
                const { type, points } = calculateMatchPoints(prediction, result, match.odds1, match.oddsX, match.odds2);
                
                if (typeCell) typeCell.textContent = type;
                if (pointsCell) pointsCell.textContent = points;
                
                // Aplicar estilos
                if (typeCell) {
                    typeCell.className = "result-type";
                    if (type === "Acierto Exacto") typeCell.classList.add("acierto-exacto");
                    else if (type === "Acierto 1X2") typeCell.classList.add("acierto-1x2");
                    else if (type === "Fallo") typeCell.classList.add("fallo");
                }
                
                if (pointsCell) {
                    pointsCell.className = "puntos";
                    if (type === "Acierto Exacto") pointsCell.classList.add("acierto-exacto");
                    else if (type === "Acierto 1X2") pointsCell.classList.add("acierto-1x2");
                    else if (type === "Fallo") pointsCell.classList.add("fallo");
                }
                
                totalPoints += points;
            });
            
            document.getElementById("points-value").textContent = totalPoints;
            return totalPoints;
        }

        // Funci√≥n para calcular todos los puntos
        function calculateAllPoints() {
            const ranking = [];
            
            for (let player = 0; player < TOTAL_PLAYERS; player++) {
                let totalPoints = 0;
                let exactHits = 0;
                let signHits = 0;
                let fails = 0;
                
                matches.forEach((match, index) => {
                    const prediction = allPlayersData[player][index].pred;
                    const result = realResults[index];
                    
                    const { points, exact, sign, fail } = calculateMatchPoints(prediction, result, match.odds1, match.oddsX, match.odds2);
                    
                    totalPoints += points;
                    exactHits += exact;
                    signHits += sign;
                    fails += fail;
                });
                
                ranking.push({
                    player: player + 1,
                    name: playerNames[player],
                    points: totalPoints,
                    exact: exactHits,
                    sign: signHits,
                    fails: fails
                });
            }
            
            // Ordenar ranking
            ranking.sort((a, b) => b.points - a.points);
            
            // Actualizar interfaces
            updateRanking(ranking);
            updateSummaryGrid(ranking);
            calculateCurrentPlayerPoints();
            
            return ranking;
        }

        // Funci√≥n para actualizar el resumen de puntos
        function updateSummaryGrid(ranking) {
            const grid = document.getElementById("summary-grid");
            grid.innerHTML = "";
            
            ranking.forEach((player, index) => {
                const card = document.createElement("div");
                card.className = "summary-card";
                card.innerHTML = `
                    <h4>${index + 1}¬∫ - ${player.name}</h4>
                    <div class="summary-points">${player.points} pts</div>
                    <div style="font-size: 0.8em; color: #666; margin-top: 5px;">
                        ${player.exact} exactos ‚Ä¢ ${player.sign} 1X2
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        // Funci√≥n para actualizar el ranking detallado
        function updateRanking(ranking) {
            const tbody = document.getElementById("ranking-body");
            tbody.innerHTML = "";
            
            ranking.forEach((player, index) => {
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${index + 1}¬∫</td>
                    <td><strong>${player.name}</strong></td>
                    <td><strong>${player.points}</strong></td>
                    <td>${player.exact}</td>
                    <td>${player.sign}</td>
                    <td>${player.fails}</td>
                `;
                tbody.appendChild(row);
            });
        }

        // Funciones de exportaci√≥n/importaci√≥n
        function exportAllData() {
            const data = {
                playerNames: playerNames,
                realResults: realResults,
                predictions: allPlayersData.map(playerData => 
                    playerData.map(match => match.pred)
                ),
                currentPlayer: currentPlayer
            };
            
            const dataString = JSON.stringify(data, null, 2);
            document.getElementById("data-textarea").value = dataString;
            return dataString;
        }

        function importAllData() {
            const dataString = document.getElementById("data-textarea").value.trim();
            
            if (!dataString) {
                alert("Por favor, pega los datos exportados en el cuadro de texto.");
                return;
            }
            
            try {
                const data = JSON.parse(dataString);
                
                if (data.realResults) realResults = data.realResults;
                if (data.predictions) {
                    data.predictions.forEach((playerPredictions, playerIndex) => {
                        playerPredictions.forEach((prediction, matchIndex) => {
                            if (playerIndex < TOTAL_PLAYERS && matchIndex < matches.length) {
                                allPlayersData[playerIndex][matchIndex].pred = prediction || "";
                            }
                        });
                    });
                }
                if (data.currentPlayer) currentPlayer = data.currentPlayer;
                
                // Actualizar interfaces
                loadRealResultsTable();
                createPlayerSelectors();
                updatePlayerInterface();
                loadPlayerPredictionsTable();
                calculateAllPoints();
                
                alert("Datos importados correctamente!");
                
            } catch (e) {
                alert("Error al importar datos: " + e.message);
            }
        }

        // Funciones de almacenamiento local
        function saveLocalData() {
            const data = {
                playerNames: playerNames,
                realResults: realResults,
                allPlayersData: allPlayersData,
                currentPlayer: currentPlayer
            };
            localStorage.setItem("championsPredictionsMulti", JSON.stringify(data));
        }

        function loadLocalData() {
            const savedData = localStorage.getItem("championsPredictionsMulti");
            if (savedData) {
                try {
                    const data = JSON.parse(savedData);
                    if (data.realResults) realResults = data.realResults;
                    if (data.allPlayersData) allPlayersData = data.allPlayersData;
                    if (data.currentPlayer) currentPlayer = data.currentPlayer;
                } catch (e) {
                    console.error("Error loading data:", e);
                }
            }
        }

        function clearCurrentPlayer() {
            if (confirm(`¬øEst√°s seguro de que quieres limpiar todas las predicciones de ${playerNames[currentPlayer-1]}?`)) {
                matches.forEach((match, index) => {
                    allPlayersData[currentPlayer-1][index].pred = "";
                });
                loadPlayerPredictionsTable();
                calculateAllPoints();
            }
        }

        function copyToClipboard() {
            const textarea = document.getElementById("data-textarea");
            textarea.select();
            try {
                document.execCommand('copy');
                alert("Datos copiados al portapapeles");
            } catch (err) {
                console.error('Error al copiar: ', err);
            }
        }

        // Inicializar la p√°gina
        document.addEventListener("DOMContentLoaded", function() {
            loadLocalData();
            loadMatches();
            
            // Asignar eventos
            document.getElementById("calculate-btn").addEventListener("click", calculateAllPoints);
            document.getElementById("clear-btn").addEventListener("click", clearCurrentPlayer);
            document.getElementById("export-btn").addEventListener("click", exportAllData);
            document.getElementById("import-btn").addEventListener("click", importAllData);
            document.getElementById("copy-data-btn").addEventListener("click", copyToClipboard);
            
            // Guardar autom√°ticamente
            document.addEventListener("input", function(e) {
                if (e.target.matches('input[data-match]')) {
                    if (e.target.id.startsWith('real-input-')) {
                        saveRealResults();
                    } else {
                        saveCurrentPlayerData();
                    }
                    calculateAllPoints();
                }
            });
        });
    </script>
</body>
</html>
